language: generic

os: osx
osx_image: xcode9.2

matrix:
  include:
  - name: "Python 2.7 Test"
    env: PYTHON=python2
  - name: "Python 3.6 Test"
    env: PYTHON=python3

addons:
  homebrew:
    packages:
    - gdal
    - cmake
    - boost
    - tcl-tk
    - python

install:
    - curl -LO https://raw.githubusercontent.com/GiovanniBussi/macports-ci/master/macports-ci
    - source ./macports-ci install
    - sudo port -N install valgrind-devel
    - ${PYTHON} -m pip install virtualenv
    - ${PYTHON} -m virtualenv env --system-site-packages
    - source env/bin/activate
    - ${PYTHON} -m pip install --upgrade --force-reinstall numpy
    - ${PYTHON} -m pip install scipy matplotlib
    - git clone https://thompsonsed@bitbucket.org/thompsonsed/pycoalescence.git
    - cd pycoalescence
    - git checkout develop
    - cd pycoalescence/lib
    - rm -rf necsim
    - git clone https://thompsonsed@bitbucket.org/thompsonsed/necsim.git
    - cd ../../../

script:
    - cd pycoalescence
    - ${PYTHON} setup.py install
    - cd pycoalescence/tests
    - valgrind ${PYTHON} test_install.py --quick --bypass_gdal_warp
    - echo "tests complete"
